<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFB Pick 'Em - Big 12 Picks</title>
    <link rel="stylesheet" href="big-twelve-style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
<header>
    <div class="header-container">
        <nav>
        <ul class="nav-menu">
            <li><a href="home.html">Home</a></li>
            <li><a href="week-overview.html">Week Overview</a></li>
            <li><a href="big-twelve.html" class="active">Big 12 Picks</a></li>
            <li><a href="mac-gotw.html">MACtion and GOTW Picks</a></li>
            <li><a href="upset-promo.html">Upset and Promo Picks</a></li>
            <li><a href="futures.html">Futures</a></li>
            <li><a href="standings.html">Current Standings</a></li>
        </ul>
        </nav>
        <button class="logout-button" onclick="window.location.href='login.html'">Log Out</button>
    </div>
</header>

<main>
    <h1>Big 12 Picks</h1>
    </div>
    <div class="matchups-container">
        <table id="picks-table">
            <thead>
                <tr>
                    <th>Matchup</th>
                    <th>Away Team</th>
                    <th>Home Team</th>
                </tr>
            </thead>
            <tbody>
                <!-- Matchups will be dynamically populated -->
            </tbody>
        </table>
        <button id="save-button">Save Picks</button>
    </div>
</main>


<script>
    // Matchups data
    const matchups = [
        { id: 1, team1: "TCU", team2: "Baylor" },
        { id: 2, team1: "Texas", team2: "Oklahoma" },
        { id: 3, team1: "Kansas State", team2: "Iowa State" },
        { id: 4, team1: "Texas Tech", team2: "West Virginia" },
        { id: 5, team1: "Kansas", team2: "Oklahoma State" }
    ];

    const picksTable = document.querySelector("#picks-table tbody");

    // Populate matchups
    matchups.forEach((matchup) => {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td><strong>${matchup.team1} vs ${matchup.team2}</strong></td>
            <td>
                <label>
                    <input type="radio" name="matchup-${matchup.id}" value="${matchup.team1}" required>
                    ${matchup.team1}
                </label>
            </td>
            <td>
                <label>
                    <input type="radio" name="matchup-${matchup.id}" value="${matchup.team2}" required>
                    ${matchup.team2}
                </label>
            </td>
        `;

        picksTable.appendChild(row);
    });

document.getElementById("save-button").addEventListener("click", () => {
    const formData = new FormData(document.querySelector("#picks-table"));
    const picks = {};

    matchups.forEach((matchup) => {
        picks[matchup.id] = formData.get(`matchup-${matchup.id}`);
    });

    // Save picks for the current user
    const allPicks = JSON.parse(localStorage.getItem("big12Picks")) || {};
    allPicks[currentUser] = picks; // Save under the current user's name
    localStorage.setItem("big12Picks", JSON.stringify(allPicks));

    alert("Your picks have been saved!");
});

    // Load existing picks
    window.onload = () => {
        const allPicks = JSON.parse(localStorage.getItem("big12Picks")) || {};
        const userPicks = allPicks[currentUser] || {};

        matchups.forEach((matchup) => {
            const selectedTeam = userPicks[matchup.id];
            if (selectedTeam) {
                const radio = document.querySelector(
                    `input[name="matchup-${matchup.id}"][value="${selectedTeam}"]`
                );
                if (radio) radio.checked = true;
            }
        });
    };

// Check if the logged-in user is Owen
if (currentUser === "Owen") {
    const exportButtonContainer = document.getElementById("export-button-container");

    // Create the Export Button
    const exportButton = document.createElement("button");
    exportButton.id = "export-button";
    exportButton.textContent = "Export to Excel";

    // Append the Export Button
    exportButtonContainer.appendChild(exportButton);

    // Add the Export Functionality
    exportButton.addEventListener("click", () => {
        const allPicks = JSON.parse(localStorage.getItem("big12Picks")) || {};

        // Convert the saved picks to a format suitable for Excel
        const data = [];
        for (const [username, picks] of Object.entries(allPicks)) {
            for (const [matchupId, selectedTeam] of Object.entries(picks)) {
                const matchup = matchups.find((m) => m.id == matchupId);
                if (matchup) {
                    data.push({
                        Username: username,
                        Matchup: `${matchup.team1} vs ${matchup.team2}`,
                        Pick: selectedTeam,
                    });
                }
            }
        }

        // Create a worksheet and export to Excel
        const worksheet = XLSX.utils.json_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Big12 Picks");
        XLSX.writeFile(workbook, "Big12_Picks.xlsx");
    });
}

</script>
</body>
</html>
